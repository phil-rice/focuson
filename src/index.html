<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>One file no compilation react app</title>
    <LINK href="index.css" rel="stylesheet" type="text/css">
    <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
    <script type="text/javascript" src="src/reactRest.js"></script>
    <script type="text/javascript" src="node_modules/crypto-js/crypto-js.js"></script>

</head>
<body>
<noscript>You need to enable JavaScript to run this app.</noscript>
<div id="root"></div>

<script>
    //This would normally be 'go get that string from the backend' Here we are hard coding it to allow us to focus on the rendering
    var gameCode = `%GAME% `
    let boardCode = `%BOARD%`
    var squareCode = `%SQUARE%`

    let gameUrl = "https://someDomain/api/game/render/" + CryptoJS.SHA256(gameCode)
    let boardUrl = "https://someDomain/api/board/render/" + CryptoJS.SHA256(boardCode)
    let squareUrl = "https://someDomain/api/square/render/" + CryptoJS.SHA256(squareCode)


    // let squareClassFromApi = eval(squareCode)
    // let boardClassFromApi = eval(boardCode)
    // let gameClassFromApi = eval(gameCode)

    let classMap = []
    classMap[gameUrl] = gameCode
    classMap[boardUrl] = boardCode
    classMap[squareUrl] = squareCode

    function loader(url) {
        return Promise.resolve(classMap[url])
    }
</script>

<script>
    var cache = new ReactRestCache(loader, CryptoJS.SHA256)

    function renderIt(json, element) {
        cache.loadFromBlob(json).then(theyAreLoaded => {
                let reactComponentClass = new ReactRest(React.createElement, cache).renderSelf(json);
                ReactDOM.render(reactComponentClass, element)
            }
        )
    }
</script>

<script>
    let gameJson = {
        _links: {_self: {href: "someUrl/For/This/Game"}},
        _render: {_self: gameUrl},
        gameData: 'Some game data properties could go here',
        _embedded: {
            board: {
                _links: {_self: {href: "someUrl/For/The/Board"}},
                _render: {_self: boardUrl, square: squareUrl},
                squares: [1, 2, 3, 4, 5, 6, 7, 8, 9]
            }
        }
    }


    function restartGame() {
        console.log("rendering")
        renderIt(gameJson, document.getElementById('root'))
    }

    restartGame()
    // cache.loadFromBlob(gameJson).then(theyAreLoaded => {
    //         let game = new ReactRest(React.createElement, cache).renderSelf(gameJson);
    //         ReactDOM.render(game, document.getElementById('root'))
    //     }
    // )


    // let dataThatCameFromApi = [1, 2, 3, 4, 5, 6, 7, 8, 9];
    // ReactDOM.render(React.createElement(gameClassFromApi, {
    //     classMap: classMap,
    //     squares: dataThatCameFromApi
    // }), document.getElementById('root'))

</script>
<button onclick="restartGame()">Restart</button>
</body>
</html>
